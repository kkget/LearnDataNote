import{ad as k,z as f,av as c,aw as v,e as p,ai as m,k as A,ax as $,ao as u,ay as F}from"./vidstack-Q8NlvF8c-uLo73VMz.js";import{E as S,t as b}from"./vidstack-3J-5HTAo-mes_NYr5.js";import"./app-spdQc88k.js";const h={qh:-1,aa:0,da:1,ja:2,ha:3,ia:5},n=class n extends S{constructor(){super(...arguments),this.scope=k(),this.J=f(""),this.K=-1,this.L=-1,this.M=0,this.N=new c(0,0),this.C=null,this.G=null,this.H=null,this.$$PROVIDER_TYPE="YOUTUBE",this.language="en",this.color="red",this.cookies=!1}get A(){return this.F.delegate.A}get currentSrc(){return this.C}get type(){return"video"}get videoId(){return this.J()}preconnect(){const t=[this.P(),"https://www.google.com","https://i.ytimg.com","https://googleads.g.doubleclick.net","https://static.doubleclick.net"];for(const s of t)v(s,"preconnect")}setup(t){this.F=t,super.setup(t),p(this.T.bind(this)),p(this.U.bind(this)),this.A("provider-setup",this)}async play(){const{paused:t}=this.F.$state;if(m(t))return this.G||(this.G=b(()=>{if(this.G=null,t())return"Timed out."}),this.I("playVideo")),this.G.promise}async pause(){const{paused:t}=this.F.$state;if(!m(t))return this.H||(this.H=b(()=>{this.H=null,t()}),this.I("pauseVideo")),this.H.promise}setMuted(t){t?this.I("mute"):this.I("unMute")}setCurrentTime(t){this.I("seekTo",t)}setVolume(t){this.I("setVolume",t*100)}setPlaybackRate(t){this.I("setPlaybackRate",t)}async loadSource(t){var e;if(!A(t.src)){this.C=null,this.J.set("");return}const s=(e=t.src.match(n.S))==null?void 0:e[1];this.J.set(s??""),this.C=t}P(){return this.cookies?"https://www.youtube.com":"https://www.youtube-nocookie.com"}T(){this.j();const t=this.J();if(!t){this.V.set("");return}this.V.set(`${this.P()}/embed/${t}`)}U(){const t=this.J(),s=n.O;if(!t)return;if(s.has(t)){const a=s.get(t);this.A("poster-change",a);return}const e=new AbortController;return this.W(t,e),()=>{e.abort()}}async W(t,s){try{const e=["maxresdefault","sddefault","hqdefault"];for(const a of e)for(const o of[!0,!1]){const i=this.X(t,a,o);if((await fetch(i,{mode:"no-cors",signal:s.signal})).status<400){n.O.set(t,i),this.A("poster-change",i);return}}}catch{}this.A("poster-change","")}X(t,s,e){return`https://i.ytimg.com/${e?"vi_webp":"vi"}/${t}/${s}.${e?"webp":"jpg"}`}ea(){const{keyDisabled:t}=this.F.$props,{$iosControls:s}=this.F,{controls:e,muted:a,playsinline:o}=this.F.$state,i=e()||s();return{autoplay:0,cc_lang_pref:this.language,cc_load_policy:i?1:void 0,color:this.color,controls:i?1:0,disablekb:!i||t()?1:0,enablejsapi:1,fs:1,hl:this.language,iv_load_policy:i?1:3,mute:a()?1:0,playsinline:o()?1:0}}I(t,s){this.Y({event:"command",func:t,args:s?[s]:void 0})}fa(){window.setTimeout(()=>this.Y({event:"listening"}),100)}Z(t){this.F.delegate.ga(void 0,t)}_(t){var s;(s=this.H)==null||s.resolve(),this.H=null,this.A("pause",void 0,t)}$(t,s){const{duration:e,currentTime:a}=this.F.$state,o=this.K===h.aa?e():t,i={currentTime:o,played:this.M>=o?this.N:this.N=new c(0,this.M)};this.A("time-update",i,s),Math.abs(o-a())>1&&this.A("seeking",o,s)}Q(t,s,e){const a={buffered:new c(0,t),seekable:s};this.A("progress",a,e);const{seeking:o,currentTime:i}=this.F.$state;o()&&t>i()&&this.R(e)}R(t){const{paused:s,currentTime:e}=this.F.$state;window.clearTimeout(this.L),this.L=window.setTimeout(()=>{this.A("seeked",e(),t),this.L=-1},s()?100:0)}ba(t){const{seeking:s}=this.F.$state;s()&&this.R(t),this.A("end",void 0,t)}ca(t,s){var i;const{paused:e}=this.F.$state,a=t===h.da,o=t===h.ha;switch(o&&this.A("waiting",void 0,s),e()&&(o||a)&&((i=this.G)==null||i.resolve(),this.G=null,this.A("play",void 0,s)),t){case h.ia:this.Z(s);break;case h.da:this.A("playing",void 0,s);break;case h.ja:this._(s);break;case h.aa:this.ba(s);break}this.K=t}ka({info:t},s){var i;if(!t)return;const{title:e,duration:a,playbackRate:o}=this.F.$state;if($(t.videoData)&&t.videoData.title!==e()&&this.A("title-change",t.videoData.title,s),u(t.duration)&&t.duration!==a()){if(u(t.videoLoadedFraction)){const r=((i=t.progressState)==null?void 0:i.loaded)??t.videoLoadedFraction*t.duration,l=new c(0,t.duration);this.Q(r,l,s)}this.A("duration-change",t.duration,s)}if(u(t.playbackRate)&&t.playbackRate!==o()&&this.A("rate-change",t.playbackRate,s),t.progressState){const{current:r,seekableStart:l,seekableEnd:g,loaded:w,duration:d}=t.progressState;this.$(r,s),this.Q(w,new c(l,g),s),d!==a()&&this.A("duration-change",d,s)}if(u(t.volume)&&F(t.muted)){const r={muted:t.muted,volume:t.volume/100};this.A("volume-change",r,s)}u(t.playerState)&&t.playerState!==this.K&&this.ca(t.playerState,s)}j(){this.K=-1,this.L=-1,this.M=0,this.N=new c(0,0),this.G=null,this.H=null}};n.S=/(?:youtu\.be|youtube|youtube\.com|youtube-nocookie\.com)\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=|)((?:\w|-){11})/,n.O=new Map;let y=n;export{y as YouTubeProvider};
